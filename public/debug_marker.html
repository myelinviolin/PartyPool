<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Marker Position</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container mt-4">
        <h2>Debug: Marker Position Check</h2>

        <div class="alert alert-warning">
            <strong>Force Refresh Instructions:</strong> Press Ctrl+Shift+R (or Cmd+Shift+R on Mac) to force refresh and bypass cache
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">Main App (in iframe) - Version 5</div>
                    <div class="card-body">
                        <iframe src="/index.html" style="width: 100%; height: 500px; border: 2px solid red;"></iframe>
                        <small>Red border shows iframe boundary</small>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">Simple Test Map</div>
                    <div class="card-body">
                        <div id="testMap" style="height: 500px;"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-header">Coordinates Check</div>
            <div class="card-body" id="coordCheck">
                Checking...
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Simple test map
        const testMap = L.map('testMap').setView([43.0747, -89.3985], 14);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(testMap);

        // Add green circle at exact State Street location
        L.circle([43.0747, -89.3985], {
            color: 'green',
            fillColor: '#0f3',
            fillOpacity: 0.3,
            radius: 30
        }).addTo(testMap).bindPopup('Exact State Street');

        // Fetch and display event marker
        fetch('/api/events.php?id=1')
            .then(r => r.json())
            .then(data => {
                const lat = parseFloat(data.event_lat);
                const lng = parseFloat(data.event_lng);

                // Add marker with inline styles (no CSS classes)
                const marker = L.marker([lat, lng], {
                    icon: L.divIcon({
                        html: '<div style="width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #FFD700, #FFA500); border-radius: 50%; border: 3px solid #FF8C00; box-shadow: 0 3px 10px rgba(255, 215, 0, 0.3);"><i class="fas fa-star" style="color: white; font-size: 24px;"></i></div>',
                        iconSize: [48, 48],
                        iconAnchor: [24, 24],
                        popupAnchor: [0, -24],
                        className: ''
                    })
                }).addTo(testMap);

                marker.bindPopup(`Event: ${data.event_name}<br>Lat: ${lat}<br>Lng: ${lng}`);

                // Display coordinate info
                const distance = L.latLng(lat, lng).distanceTo(L.latLng(43.0747, -89.3985));
                document.getElementById('coordCheck').innerHTML = `
                    <strong>Database Coordinates:</strong> ${lat}, ${lng}<br>
                    <strong>Expected (State Street):</strong> 43.0747, -89.3985<br>
                    <strong>Distance from State Street:</strong> ${Math.round(distance)} meters<br>
                    <strong>Status:</strong> ${distance < 5 ? '✅ CORRECT' : '❌ INCORRECT'}<br>
                    <br>
                    <strong>JavaScript Version:</strong> v=5<br>
                    <strong>Cache Status:</strong> Press Ctrl+Shift+R to force refresh
                `;
            });
    </script>
</body>
</html>