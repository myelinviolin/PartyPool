<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Button State Change</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container mt-4">
        <h2>Button State Change Test</h2>

        <div class="alert alert-info">
            Open browser console (F12) to see debug messages
        </div>

        <div class="card">
            <div class="card-body">
                <form id="eventForm">
                    <input type="hidden" id="eventId" value="1">

                    <div class="mb-3">
                        <label class="form-label">Event Name</label>
                        <input type="text" class="form-control" id="eventName" value="Spring Rally 2026">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Event Address</label>
                        <input type="text" class="form-control" id="eventAddress" value="Wisconsin State Capitol, Madison, WI">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Event Date</label>
                        <input type="date" class="form-control" id="eventDate" value="2026-02-08">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Event Time</label>
                        <input type="time" class="form-control" id="eventTime" value="19:00">
                    </div>

                    <button type="button" class="btn btn-secondary w-100" onclick="updateEvent(this)" disabled>
                        <i class="fas fa-save"></i> Update Event
                    </button>
                </form>

                <div class="mt-3">
                    <button class="btn btn-warning" onclick="debugState()">Debug Current State</button>
                    <button class="btn btn-info" onclick="forceEnable()">Force Enable Button</button>
                    <button class="btn btn-danger" onclick="forceDisable()">Force Disable Button</button>
                </div>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-header">Debug Output</div>
            <div class="card-body">
                <pre id="debug" style="max-height: 300px; overflow-y: auto;">Ready...</pre>
            </div>
        </div>
    </div>

    <script>
        let originalEventData = {};

        function log(msg, data = null) {
            const debugEl = document.getElementById('debug');
            const time = new Date().toLocaleTimeString();
            let logMsg = `[${time}] ${msg}`;
            if (data) {
                logMsg += '\n' + JSON.stringify(data, null, 2);
            }
            debugEl.textContent += '\n' + logMsg;
            console.log(msg, data || '');
            debugEl.scrollTop = debugEl.scrollHeight;
        }

        function storeOriginalValues() {
            originalEventData = {
                event_name: document.getElementById('eventName')?.value || '',
                event_address: document.getElementById('eventAddress')?.value || '',
                event_date: document.getElementById('eventDate')?.value || '',
                event_time: document.getElementById('eventTime')?.value || ''
            };
            log('Stored original values:', originalEventData);
        }

        function checkFormChanged() {
            const currentData = {
                event_name: document.getElementById('eventName')?.value || '',
                event_address: document.getElementById('eventAddress')?.value || '',
                event_date: document.getElementById('eventDate')?.value || '',
                event_time: document.getElementById('eventTime')?.value || ''
            };

            const hasChanged = JSON.stringify(originalEventData) !== JSON.stringify(currentData);
            log(`Change detected: ${hasChanged}`, { original: originalEventData, current: currentData });

            const updateBtn = document.querySelector('button[onclick*="updateEvent"]');
            if (updateBtn) {
                updateBtn.disabled = !hasChanged;
                if (!hasChanged) {
                    updateBtn.classList.add('btn-secondary');
                    updateBtn.classList.remove('btn-primary');
                } else {
                    updateBtn.classList.remove('btn-secondary');
                    updateBtn.classList.add('btn-primary');
                }
                log(`Button updated - Enabled: ${!updateBtn.disabled}, Classes: ${updateBtn.className}`);
            } else {
                log('ERROR: Update button not found!');
            }
        }

        function updateEvent(btn) {
            log('Update Event clicked!');
            alert('Update Event clicked! (This is just a test)');
            // In real implementation, this would save and then:
            storeOriginalValues();
            checkFormChanged();
        }

        function debugState() {
            const currentData = {
                event_name: document.getElementById('eventName')?.value || '',
                event_address: document.getElementById('eventAddress')?.value || '',
                event_date: document.getElementById('eventDate')?.value || '',
                event_time: document.getElementById('eventTime')?.value || ''
            };

            const updateBtn = document.querySelector('button[onclick*="updateEvent"]');

            log('=== DEBUG STATE ===');
            log('Original:', originalEventData);
            log('Current:', currentData);
            log('Has Changed:', JSON.stringify(originalEventData) !== JSON.stringify(currentData));
            log('Button Disabled:', updateBtn?.disabled);
            log('Button Classes:', updateBtn?.className);
        }

        function forceEnable() {
            const updateBtn = document.querySelector('button[onclick*="updateEvent"]');
            if (updateBtn) {
                updateBtn.disabled = false;
                updateBtn.classList.remove('btn-secondary');
                updateBtn.classList.add('btn-primary');
                log('Button force enabled');
            }
        }

        function forceDisable() {
            const updateBtn = document.querySelector('button[onclick*="updateEvent"]');
            if (updateBtn) {
                updateBtn.disabled = true;
                updateBtn.classList.add('btn-secondary');
                updateBtn.classList.remove('btn-primary');
                log('Button force disabled');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            log('Page loaded, initializing...');

            storeOriginalValues();

            // Add all possible event listeners
            ['eventName', 'eventAddress', 'eventDate', 'eventTime'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    log(`Adding listeners to: ${id}`);

                    // Add multiple event types to catch all changes
                    element.addEventListener('input', () => {
                        log(`Input event on ${id}`);
                        checkFormChanged();
                    });

                    element.addEventListener('change', () => {
                        log(`Change event on ${id}`);
                        checkFormChanged();
                    });

                    element.addEventListener('keyup', () => {
                        log(`Keyup event on ${id}`);
                        checkFormChanged();
                    });

                    element.addEventListener('paste', () => {
                        log(`Paste event on ${id}`);
                        setTimeout(checkFormChanged, 10);
                    });
                } else {
                    log(`ERROR: Element not found: ${id}`);
                }
            });

            // Initial check
            checkFormChanged();
            log('Initialization complete');
        });
    </script>
</body>
</html>