<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Button Issue</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-4">
        <h2>Debug: Button Still Grey Issue</h2>

        <div class="alert alert-warning">
            <strong>Testing:</strong> Open browser console (F12) to see what's happening
        </div>

        <div class="card">
            <div class="card-body">
                <iframe src="dashboard.php" style="width: 100%; height: 600px; border: 1px solid #ccc;"></iframe>
            </div>
        </div>

        <div class="mt-3">
            <button class="btn btn-primary" onclick="checkFunctions()">Check If Functions Exist</button>
            <button class="btn btn-warning" onclick="testInConsole()">Test in Console</button>
        </div>

        <pre id="output" class="mt-3 p-3 bg-dark text-light">
Ready to debug...
        </pre>
    </div>

    <script>
        function log(msg) {
            document.getElementById('output').textContent += '\n' + msg;
            console.log(msg);
        }

        function checkFunctions() {
            log('=== Checking Functions ===');

            // Try to access the iframe
            try {
                const iframe = document.querySelector('iframe');
                const iframeWindow = iframe.contentWindow;

                log('checkFormChanged exists: ' + (typeof iframeWindow.checkFormChanged === 'function'));
                log('storeOriginalValues exists: ' + (typeof iframeWindow.storeOriginalValues === 'function'));
                log('updateEvent exists: ' + (typeof iframeWindow.updateEvent === 'function'));
                log('originalEventData: ' + JSON.stringify(iframeWindow.originalEventData));

                // Try to get current values
                const eventName = iframeWindow.document.getElementById('eventName');
                const eventAddress = iframeWindow.document.getElementById('eventAddress');

                log('Event Name field exists: ' + !!eventName);
                log('Event Address field exists: ' + !!eventAddress);

                if (eventName) {
                    log('Current Event Name value: ' + eventName.value);
                }
                if (eventAddress) {
                    log('Current Event Address value: ' + eventAddress.value);
                }

                // Check button
                const button = iframeWindow.document.querySelector('button[onclick*="updateEvent"]');
                log('Button found: ' + !!button);
                if (button) {
                    log('Button disabled: ' + button.disabled);
                    log('Button classes: ' + button.className);
                }

            } catch (error) {
                log('Error accessing iframe: ' + error.message);
            }
        }

        function testInConsole() {
            log('=== Console Test Instructions ===');
            log('1. Open browser console (F12)');
            log('2. Right-click the dashboard page inside the iframe');
            log('3. Select "Inspect" to focus console on iframe');
            log('4. Type these commands:');
            log('   typeof checkFormChanged');
            log('   typeof storeOriginalValues');
            log('   typeof updateEvent');
            log('   originalEventData');
            log('5. Try manually calling: checkFormChanged()');
        }
    </script>
</body>
</html>